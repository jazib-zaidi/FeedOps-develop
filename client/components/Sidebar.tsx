import { Link, useLocation } from "react-router-dom";
import { useSidebar } from "@/components/ui/sidebar";

interface NavItem {
  icon: React.ReactNode;
  label: string;
  href: string;
  badge?: string;
}

export function Sidebar() {
  const location = useLocation();

  // Determine whether the sidebar is collapsed (icon-only) or expanded (icon + text).
  // If `useSidebar` is not available (no provider), default to expanded behavior.
  let collapsed = false;
  try {
    const { isMobile, state, openMobile } = useSidebar();
    // On mobile we use `openMobile` to decide visibility; keep expanded layout when visible.
    if (isMobile) {
      collapsed = !openMobile;
    } else {
      collapsed = state === "collapsed";
    }
  } catch (e) {
    collapsed = false;
  }

  const navItems: NavItem[] = [
    {
      icon: (
        <svg width="25" height="25" viewBox="0 0 25 25" fill="none">
          <path
            d="M12.6342 22.6371C15.2869 22.6371 17.831 21.5833 19.7068 19.7075C21.5826 17.8318 22.6364 15.2877 22.6364 12.6349C22.6364 9.98222 21.5826 7.43813 19.7068 5.56237C17.831 3.68661 15.2869 2.63281 12.6342 2.63281C9.98148 2.63281 7.4374 3.68661 5.56164 5.56237C3.68587 7.43813 2.63208 9.98222 2.63208 12.6349C2.63208 15.2877 3.68587 17.8318 5.56164 19.7075C7.4374 21.5833 9.98148 22.6371 12.6342 22.6371Z"
            stroke="currentColor"
            strokeWidth="1.58"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
          <path
            d="M2.63208 12.6349H22.6364M12.6342 22.6371C15.0895 22.6371 17.0794 18.1593 17.0794 12.6349C17.0794 7.11061 15.0895 2.63281 12.6342 2.63281C10.179 2.63281 8.18906 7.11061 8.18906 12.6349C8.18906 18.1593 10.179 22.6371 12.6342 22.6371Z"
            stroke="currentColor"
            strokeWidth="1.58"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </svg>
      ),
      label: "Overview",
      href: "/under-development",
    },
    {
      icon: (
        <svg width="21" height="21" viewBox="0 0 21 21" fill="none">
          <g clipPath="url(#clip0)">
            <path
              d="M8.71917 13.5988C8.64084 13.2951 8.48258 13.018 8.26085 12.7963C8.03911 12.5746 7.76201 12.4163 7.45838 12.338L2.07565 10.9499C1.98382 10.9239 1.90299 10.8686 1.84544 10.7924C1.78788 10.7162 1.75674 10.6234 1.75674 10.5279C1.75674 10.4325 1.78788 10.3396 1.84544 10.2634C1.90299 10.1873 1.98382 10.132 2.07565 10.1059L7.45838 8.71702C7.76191 8.63876 8.03893 8.48063 8.26066 8.25906C8.48238 8.03749 8.64071 7.76057 8.71917 7.4571L10.1072 2.07437C10.133 1.98217 10.1882 1.90095 10.2645 1.84309C10.3408 1.78523 10.4339 1.75391 10.5296 1.75391C10.6254 1.75391 10.7185 1.78523 10.7948 1.84309C10.8711 1.90095 10.9263 1.98217 10.9521 2.07437L12.3392 7.4571C12.4176 7.76073 12.5758 8.03783 12.7976 8.25956C13.0193 8.4813 13.2964 8.63956 13.6 8.71789L18.9828 10.105C19.0753 10.1306 19.157 10.1858 19.2151 10.2621C19.2733 10.3385 19.3048 10.4319 19.3048 10.5279C19.3048 10.6239 19.2733 10.7173 19.2151 10.7937C19.157 10.8701 19.0753 10.9253 18.9828 10.9508L13.6 12.338C13.2964 12.4163 13.0193 12.5746 12.7976 12.7963C12.5758 13.018 12.4176 13.2951 12.3392 13.5988L10.9512 18.9815C10.9254 19.0737 10.8702 19.1549 10.7939 19.2128C10.7176 19.2706 10.6245 19.302 10.5288 19.302C10.433 19.302 10.3399 19.2706 10.2636 19.2128C10.1874 19.1549 10.1321 19.0737 10.1063 18.9815L8.71917 13.5988Z"
              stroke="currentColor"
              strokeWidth="1.75"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M17.5475 2.63208V6.1416M19.303 4.38721H15.7935M3.5108 14.9158V16.6705M4.38751 15.7927H2.63275"
              stroke="currentColor"
              strokeWidth="1.75"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </g>
        </svg>
      ),
      label: "Playbook",
      href: "/under-development",
    },
    {
      icon: (
        <svg width="21" height="21" viewBox="0 0 21 21" fill="none">
          <g clipPath="url(#clip1)">
            <path
              d="M10.9676 19.3022H15.7932C16.2586 19.3022 16.7049 19.1174 17.034 18.7883C17.3631 18.4592 17.548 18.0129 17.548 17.5475V6.14154L13.1611 1.75464H5.26465C4.79926 1.75464 4.35293 1.93951 4.02385 2.2686C3.69476 2.59768 3.50989 3.04401 3.50989 3.5094V11.8445"
              stroke="currentColor"
              strokeWidth="1.75"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M12.2823 1.75464V5.26416C12.2823 5.72955 12.4672 6.17588 12.7963 6.50496C13.1254 6.83404 13.5717 7.01892 14.0371 7.01892H17.5466M11.7371 13.7096C11.9101 13.5365 12.0474 13.3311 12.1411 13.105C12.2347 12.8789 12.2829 12.6365 12.2829 12.3918C12.2829 12.147 12.2347 11.9047 12.1411 11.6786C12.0474 11.4524 11.9101 11.247 11.7371 11.0739C11.564 10.9009 11.3586 10.7636 11.1325 10.6699C10.9063 10.5763 10.664 10.5281 10.4193 10.5281C10.1745 10.5281 9.93217 10.5763 9.70606 10.6699C9.47994 10.7636 9.27449 10.9009 9.10143 11.0739L4.70576 15.4714C4.49716 15.6799 4.34447 15.9376 4.2618 16.2207L3.52744 18.7387C3.50542 18.8142 3.5041 18.8943 3.52361 18.9704C3.54313 19.0466 3.58277 19.1162 3.63838 19.1718C3.69399 19.2274 3.76352 19.267 3.8397 19.2865C3.91589 19.306 3.99591 19.3047 4.07141 19.2827L6.58949 18.5483C6.87259 18.4657 7.13029 18.313 7.33878 18.1044L11.7371 13.7096Z"
              stroke="currentColor"
              strokeWidth="1.75"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </g>
        </svg>
      ),
      label: "Products",
      href: "/",
    },
    {
      icon: (
        <svg width="21" height="21" viewBox="0 0 21 21" fill="none">
          <g clipPath="url(#clip2)">
            <path
              d="M10.7203 1.75562H10.3342C9.86882 1.75562 9.42249 1.94049 9.09341 2.26957C8.76433 2.59865 8.57945 3.04498 8.57945 3.51038V3.6683C8.57913 3.97602 8.4979 4.27825 8.34391 4.54466C8.18991 4.81108 7.96856 5.03231 7.70207 5.18617L7.3248 5.40552C7.05804 5.55953 6.75544 5.64061 6.44742 5.64061C6.13939 5.64061 5.83679 5.55953 5.57004 5.40552L5.43843 5.33533C5.03577 5.10305 4.5574 5.04004 4.10832 5.16012C3.65925 5.2802 3.27617 5.57357 3.04318 5.97581L2.85016 6.30922C2.61788 6.71188 2.55487 7.19025 2.67495 7.63933C2.79503 8.0884 3.0884 8.47148 3.49064 8.70447L3.62225 8.79221C3.88746 8.94532 4.10799 9.16517 4.26191 9.42991C4.41583 9.69466 4.49778 9.99507 4.49963 10.3013V10.7488C4.50086 11.058 4.42036 11.362 4.26629 11.6301C4.11221 11.8982 3.89004 12.1208 3.62225 12.2754L3.49064 12.3544C3.0884 12.5874 2.79503 12.9704 2.67495 13.4195C2.55487 13.8686 2.61788 14.347 2.85016 14.7496L3.04318 15.083C3.27617 15.4853 3.65925 15.7786 4.10832 15.8987C4.5574 16.0188 5.03577 15.9558 5.43843 15.7235L5.57004 15.6533C5.83679 15.4993 6.13939 15.4182 6.44742 15.4182C6.75544 15.4182 7.05804 15.4993 7.3248 15.6533L7.70207 15.8727C7.96856 16.0265 8.18991 16.2478 8.34391 16.5142C8.4979 16.7806 8.57913 17.0828 8.57945 17.3905V17.5485C8.57945 18.0139 8.76433 18.4602 9.09341 18.7893C9.42249 19.1183 9.86882 19.3032 10.3342 19.3032H10.7203C11.1857 19.3032 11.632 19.1183 11.9611 18.7893C12.2901 18.4602 12.475 18.0139 12.475 17.5485V17.3905C12.4753 17.0828 12.5566 16.7806 12.7106 16.5142C12.8646 16.2478 13.0859 16.0265 13.3524 15.8727L13.7297 15.6533C13.9964 15.4993 14.299 15.4182 14.6071 15.4182C14.9151 15.4182 15.2177 15.4993 15.4844 15.6533L15.616 15.7235C16.0187 15.9558 16.4971 16.0188 16.9461 15.8987C17.3952 15.7786 17.7783 15.4853 18.0113 15.083L18.2043 14.7408C18.4366 14.3382 18.4996 13.8598 18.3795 13.4107C18.2594 12.9617 17.9661 12.5786 17.5638 12.3456L17.4322 12.2754C17.1644 12.1208 16.9423 11.8982 16.7882 11.6301C16.6341 11.362 16.5536 11.058 16.5548 10.7488V10.3101C16.5536 10.0009 16.6341 9.69683 16.7882 9.42874C16.9423 9.16065 17.1644 8.93803 17.4322 8.78343L17.5638 8.70447C17.9661 8.47148 18.2594 8.0884 18.3795 7.63933C18.4996 7.19025 18.4366 6.71188 18.2043 6.30922L18.0113 5.97581C17.7783 5.57357 17.3952 5.2802 16.9461 5.16012C16.4971 5.04004 16.0187 5.10305 15.616 5.33533L15.4844 5.40552C15.2177 5.55953 14.9151 5.64061 14.6071 5.64061C14.299 5.64061 13.9964 5.55953 13.7297 5.40552L13.3524 5.18617C13.0859 5.03231 12.8646 4.81108 12.7106 4.54466C12.5566 4.27825 12.4753 3.97602 12.475 3.6683V3.51038C12.475 3.04498 12.2901 2.59865 11.9611 2.26957C11.632 1.94049 11.1857 1.75562 10.7203 1.75562Z"
              stroke="currentColor"
              strokeWidth="1.75"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
            <path
              d="M10.5283 13.1613C11.982 13.1613 13.1604 11.9828 13.1604 10.5291C13.1604 9.07542 11.982 7.89697 10.5283 7.89697C9.07457 7.89697 7.89612 9.07542 7.89612 10.5291C7.89612 11.9828 9.07457 13.1613 10.5283 13.1613Z"
              stroke="currentColor"
              strokeWidth="1.75"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </g>
        </svg>
      ),
      label: "Feed Rules",
      href: "/under-development",
    },
    {
      icon: (
        <svg width="21" height="21" viewBox="0 0 21 21" fill="none">
          <path
            d="M19.0659 15.7923L12.0468 3.50896C11.8938 3.2389 11.6719 3.01428 11.4037 2.858C11.1355 2.70172 10.8306 2.61938 10.5202 2.61938C10.2098 2.61938 9.90494 2.70172 9.63674 2.858C9.36855 3.01428 9.1466 3.2389 8.99356 3.50896L1.97451 15.7923C1.81982 16.0602 1.7387 16.3642 1.73938 16.6736C1.74007 16.983 1.82253 17.2867 1.97842 17.5539C2.1343 17.8211 2.35806 18.0424 2.62702 18.1953C2.89598 18.3482 3.20057 18.4272 3.50993 18.4244H17.548C17.8559 18.4241 18.1583 18.3428 18.4248 18.1887C18.6913 18.0345 18.9125 17.813 19.0663 17.5463C19.2201 17.2796 19.3011 16.9771 19.301 16.6692C19.3009 16.3613 19.2198 16.0589 19.0659 15.7923Z"
            stroke="currentColor"
            strokeWidth="1.75"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
          <path
            d="M10.5283 7.896V11.4055M10.5283 14.9153H10.5366"
            stroke="currentColor"
            strokeWidth="1.75"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </svg>
      ),
      label: "Alerts",
      href: "/under-development",
    },
    {
      icon: (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path
            d="M12 21L20.131 16.792C20.447 16.628 20.605 16.547 20.72 16.426C20.8219 16.3198 20.899 16.1925 20.946 16.053C21 15.894 21 15.717 21 15.361V7.53302M12 21L3.869 16.792C3.553 16.628 3.395 16.547 3.28 16.426C3.17814 16.3198 3.10097 16.1925 3.054 16.053C3 15.894 3 15.716 3 15.359V7.53302M12 21V11.937M21 7.53302L12 11.937M21 7.53302L12.73 3.25302C12.463 3.11502 12.33 3.04502 12.189 3.01802C12.0641 2.99399 11.9359 2.99399 11.811 3.01802C11.671 3.04502 11.537 3.11502 11.269 3.25302L3 7.53302M3 7.53302L12 11.937"
            stroke="currentColor"
            strokeWidth="1.5"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </svg>
      ),
      label: "Orders",
      href: "/under-development",
      badge: "new",
    },
  ];

  const settingsItem = {
    icon: (
      <svg width="21" height="21" viewBox="0 0 21 21" fill="none">
        <path
          d="M10.7212 1.75378H10.3351C9.86973 1.75378 9.4234 1.93866 9.09432 2.26774C8.76524 2.59682 8.58037 3.04315 8.58037 3.50854V3.66647C8.58005 3.97419 8.49882 4.27642 8.34482 4.54283C8.19083 4.80925 7.96948 5.03048 7.70299 5.18434L7.32571 5.40369C7.05895 5.5577 6.75636 5.63878 6.44833 5.63878C6.14031 5.63878 5.83771 5.5577 5.57095 5.40369L5.43934 5.3335C5.03668 5.10122 4.55831 5.03821 4.10924 5.15829C3.66016 5.27837 3.27709 5.57174 3.0441 5.97398L2.85107 6.30739C2.6188 6.71005 2.55578 7.18842 2.67587 7.6375C2.79595 8.08657 3.08931 8.46965 3.49156 8.70264L3.62317 8.79038C3.88838 8.94349 4.1089 9.16334 4.26282 9.42808C4.41674 9.69282 4.4987 9.99324 4.50055 10.2995V10.7469C4.50177 11.0561 4.42128 11.3602 4.2672 11.6283C4.11313 11.8964 3.89095 12.119 3.62317 12.2736L3.49156 12.3525C3.08931 12.5855 2.79595 12.9686 2.67587 13.4177C2.55578 13.8668 2.6188 14.3451 2.85107 14.7478L3.0441 15.0812C3.27709 15.4834 3.66016 15.7768 4.10924 15.8969C4.55831 16.017 5.03668 15.954 5.43934 15.7217L5.57095 15.6515C5.83771 15.4975 6.14031 15.4164 6.44833 15.4164C6.75636 15.4164 7.05895 15.4975 7.32571 15.6515L7.70299 15.8708C7.96948 16.0247 8.19083 16.2459 8.34482 16.5123C8.49882 16.7788 8.58005 17.081 8.58037 17.3887V17.5466C8.58037 18.012 8.76524 18.4584 9.09432 18.7874C9.4234 19.1165 9.86973 19.3014 10.3351 19.3014H10.7212C11.1866 19.3014 11.6329 19.1165 11.962 18.7874C12.2911 18.4584 12.4759 18.012 12.4759 17.5466V17.3887C12.4763 17.081 12.5575 16.7788 12.7115 16.5123C12.8655 16.2459 13.0868 16.0247 13.3533 15.8708L13.7306 15.6515C13.9973 15.4975 14.2999 15.4164 14.608 15.4164C14.916 15.4164 15.2186 15.4975 15.4853 15.6515L15.617 15.7217C16.0196 15.954 16.498 16.017 16.9471 15.8969C17.3961 15.7768 17.7792 15.4834 18.0122 15.0812L18.2052 14.739C18.4375 14.3364 18.5005 13.858 18.3804 13.4089C18.2604 12.9598 17.967 12.5768 17.5647 12.3438L17.4331 12.2736C17.1654 12.119 16.9432 11.8964 16.7891 11.6283C16.635 11.3602 16.5545 11.0561 16.5558 10.7469V10.3082C16.5545 9.99904 16.635 9.695 16.7891 9.42691C16.9432 9.15882 17.1654 8.9362 17.4331 8.7816L17.5647 8.70264C17.967 8.46965 18.2604 8.08657 18.3804 7.6375C18.5005 7.18842 18.4375 6.71005 18.2052 6.30739L18.0122 5.97398C17.7792 5.57174 17.3961 5.27837 16.9471 5.15829C16.498 5.03821 16.0196 5.10122 15.617 5.3335L15.4853 5.40369C15.2186 5.5577 14.916 5.63878 14.608 5.63878C14.2999 5.63878 13.9973 5.5577 13.7306 5.40369L13.3533 5.18434C13.0868 5.03048 12.8655 4.80925 12.7115 4.54283C12.5575 4.27642 12.4763 3.97419 12.4759 3.66647V3.50854C12.4759 3.04315 12.2911 2.59682 11.962 2.26774C11.6329 1.93866 11.1866 1.75378 10.7212 1.75378Z"
          stroke="currentColor"
          strokeWidth="1.75"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
        <path
          d="M10.5292 13.1605C11.9829 13.1605 13.1613 11.9821 13.1613 10.5284C13.1613 9.07469 11.9829 7.89624 10.5292 7.89624C9.07548 7.89624 7.89703 9.07469 7.89703 10.5284C7.89703 11.9821 9.07548 13.1605 10.5292 13.1605Z"
          stroke="currentColor"
          strokeWidth="1.75"
          strokeLinecap="round"
          strokeLinejoin="round"
        />
      </svg>
    ),
    label: "Settings",
    href: "/under-development",
  };

  return (
    <aside
      className={`fixed left-0 top-[70px] h-[calc(100vh-70px)] bg-white border-r border-gray-200 shadow-sm flex flex-col justify-between z-10 ${
        collapsed ? "w-[67px]" : "w-[220px]"
      }`}
    >
      <nav className="flex flex-col gap-2 pt-6 px-2">
        {navItems.map((item, index) => {
          const isActive = location.pathname === item.href;
          return (
            <Link
              key={index}
              to={item.href}
              className={`relative group flex items-center gap-3 transition-colors rounded-[10px] h-[42px] px-2 ${
                collapsed ? "justify-center" : "justify-start"
              } ${isActive ? "bg-white" : "hover:bg-gray-50"}`}
            >
              <div
                className={`${isActive ? "text-[#4A5565]" : "text-[#4A5565]"}`}
              >
                {item.icon}
              </div>

              {/* Badge */}
              {item.badge && (
                <div className="absolute -top-1 -right-1 w-2 h-2 rounded-full bg-[#AD46FF]" />
              )}

              {/* Label: visible when expanded, hidden when collapsed. Keep the hover tooltip for collapsed state. */}
              {!collapsed ? (
                <span className="text-[13px] font-medium text-[#101828] select-none">
                  {item.label}
                </span>
              ) : (
                <div className="absolute left-[51px] top-2 hidden group-hover:flex items-center bg-[#101828] text-white text-[13px] font-medium px-2 py-1 rounded whitespace-nowrap z-20">
                  {item.label}
                </div>
              )}
            </Link>
          );
        })}
      </nav>

      <div className="flex flex-col gap-4 pb-6 px-2">
        <Link
          to={settingsItem.href}
          className={`group relative flex items-center gap-3 rounded-[10px] h-[42px] px-2 ${
            collapsed ? "justify-center" : "justify-start"
          } hover:bg-gray-50 transition-colors`}
        >
          <div className="text-[#4A5565]">{settingsItem.icon}</div>
          {!collapsed ? (
            <span className="text-[13px] font-medium text-[#101828] select-none">
              {settingsItem.label}
            </span>
          ) : (
            <div className="absolute left-[51px] top-2 hidden group-hover:flex items-center bg-[#101828] text-white text-[13px] font-medium px-2 py-1 rounded whitespace-nowrap z-20">
              {settingsItem.label}
            </div>
          )}
        </Link>

        <button className="flex items-center justify-center w-10 h-10 rounded-lg bg-[#ECECEC]">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path
              d="M6.66666 1.66663V4.99996M13.3333 1.66663V4.99996M15.8333 3.33337H4.16667C3.24619 3.33337 2.5 4.07957 2.5 5.00004V16.6667C2.5 17.5872 3.24619 18.3334 4.16667 18.3334H15.8333C16.7538 18.3334 17.5 17.5872 17.5 16.6667V5.00004C17.5 4.07957 16.7538 3.33337 15.8333 3.33337ZM2.5 8.33337H17.5"
              stroke="#4D4D4D"
              strokeWidth="1.67"
              strokeLinecap="round"
              strokeLinejoin="round"
            />
          </svg>
        </button>
      </div>
    </aside>
  );
}
